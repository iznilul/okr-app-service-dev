<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.softlab.okr.mapper.BookMapper">
<<<<<<< HEAD
<<<<<<< HEAD
  <resultMap id="bookMap" type="com.softlab.okr.entity.Book">
=======
  <resultMap id="BaseResultMap" type="com.softlab.okr.entity.Book">
>>>>>>> mybatis plus重构
=======
  <resultMap id="BaseResultMap" type="com.softlab.okr.entity.Book">
>>>>>>> mybatis plus重构
    <id property="bookId" column="book_id"/>
    <result property="bookName" column="book_name"/>
    <result property="img" column="img"/>
    <result property="publisher" column="publisher"/>
    <result property="price" column="price"/>
    <result property="status" column="status"/>
    <result property="userId" column="user_id"/>
    <result property="createTime" column="create_time"/>
    <result property="updateTime" column="update_time"/>
  </resultMap>

  <resultMap id="VoMap" type="com.softlab.okr.model.vo.BookVO">
    <id property="bookId" column="book_id"/>
    <result property="bookName" column="book_name"/>
    <result property="img" column="img"/>
    <result property="publisher" column="publisher"/>
    <result property="price" column="price"/>
    <result property="userName" column="user_name"/>
    <result property="status" column="status"/>
  </resultMap>


  <sql id="Base_Column_List">
    `book_id`,`book_name`,`img`,`publisher`,`price`,`status`,`user_id`,`create_time`,`update_time`
  </sql>

  <sql id="bookTagColumn">
    `book_id`,`tag_id`
  </sql>

  <sql id="tag">
    `book_tag`
  </sql>

  <!--    根据条件选取book-->
  <select id="selectByCond" resultMap="VoMap">
    select
    book.book_id,
    book.book_name,
    book.img,
    book.publisher,
    book.price,
    user_info.name as user_name,
    book.status
    from book
    join user_info on book.user_id is not null and book.user_id=user_info.user_id
    where 1=1
    <if test="bookName!='' and bookName!=null">and `book_name` like '%${bookName}%'</if>
    <if test="publisher!='' and publisher!=null">and `publisher` like '%${publisher}%'</if>
    <if test="status!=null">and `status` = #{status}</if>
  </select>

  <update id="updateBook">
    update `book` set
    `book_name`=#{bookName},
    `publisher`=#{publisher},
    `price`=#{price},
    `status`=#{status},
    `user_id`=(select user_id from `user` where `name`=#{userName}),
    `update_time`=now()
    where book_id=#{bookId}
  </update>


</mapper>
